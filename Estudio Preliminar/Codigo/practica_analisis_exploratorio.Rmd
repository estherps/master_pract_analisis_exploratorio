---
title: "PrÃƒÂ¡ctica AnÃƒÂ¡lisis Exploratorio"
author: "Esther Puerto Sanz"
date: "10 December 2018"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "../Datos")
```

##1-Introducción

Nuestro objetivo de análisis es identificar cuáles pueden ser las principales variables que afectan al éxito o fracaso en la educación de los estudiantes de Matemáticas y además predecir el valor de la nota final G3, que va a ser nuestra variable objetivo.

##2-Carga de Paquetes y Datos

Antes de cargar los datos, procedemos a instalar y cargar las librerias necesarias para el Análisis Exploratorio. Instalamos 2 paquetes, "Nortest" para medir la normalidad de Lilliefors a través de la función "lillie.test",  "Arule" para el estudio de "apriori" y por último el paquete "MASS" para la función "stepAIC" para hacer la selección de variables de un modelo de regresión lineal.


```{r librerias, echo=TRUE, message=FALSE, warning=FALSE}
getwd()
if(!is.element("arules", installed.packages())){
  install.packages("arules")
}
library(arules)

if(!is.element("nortest", installed.packages())){
  install.packages("nortest")
}
library(nortest)

if(!is.element("MASS", installed.packages())){
  install.packages("MASS")
}
library(MASS)
```

Se cargan los datos correspondientes a "Student Performance Data Set" de Machine Learning Repository que recoge información de estudiantes de Secundaria de dos colegios Portugueses en las asignaturas de Matemáticas.

```{r carga de datos, echo=TRUE}

studentMat <- read.table("student-mat.csv", row.names=NULL, sep=";", header = TRUE)

```
Este dataset contiene 382 casos.


## 3 - Análisis Descriptivo
###   3.1 Análisis descriptivo de todas las variables
Realizamos un análisi descriptivo de todas las variables del fichero "student-mat" a través de la función "summary()"

```{r, echo=TRUE}

summary(studentMat)

```
Miramos la normalidad de nuestra variable objetivo: G3. test normalidad g3- kolmogorov porque hay mas de 30 observaciones. normalidad de g3 para comparar medias o medianas. Vamos a anlaizar variable continua con binaria.

```{r}
#ks.test(studentMat$G3, pnorm, mean(studentMat$G3, sd(studentMat$G3)))
lillie.test(x=studentMat$G3)

```
 Rechazamos la hipotesis nula de Normalidad, por lo que comparamos medianas.


Procedemos a realizar un diagrama de cajas o boxplot de nuestra variable objetivo: G3.

```{r, boxplot}

boxplot(studentMat$G3, main= 'G3', xlab= 'G3', ylab= 'final grades')
```
Observamos que la línea gruesa de la caja correspondiente a la mediana se situa entorno a la nota 11.

Vamos a sacar las frecuencias de las variables binarias y categóricas:

```{r, frecuencias, echo=FALSE}
##School
prop.table(table(studentMat$school))
## sex
prop.table(table(studentMat$sex))
##address
prop.table(table(studentMat$address))
##Famsize
prop.table(table(studentMat$famsize))
##Pstatus
prop.table(table(studentMat$Pstatus))
##Medu
table(studentMat$Medu)
prop.table(table(studentMat$Medu))
##Fedu
table(studentMat$Fedu)
prop.table(table(studentMat$Fedu))
##Mjob
table(studentMat$Mjob)
prop.table(table(studentMat$Mjob))
##Fjob
table(studentMat$Fjob)
prop.table(table(studentMat$Fjob))
##reason
table(studentMat$reason)
prop.table(table(studentMat$reason))
##guardian
table(studentMat$guardian)
prop.table(table(studentMat$guardian))
##traveltime
table(studentMat$traveltime)
prop.table(table(studentMat$traveltime))
##studytime
table(studentMat$studytime)
prop.table(table(studentMat$studytime))
##failures
table(studentMat$failures)
prop.table(table(studentMat$failures))
##schoolsup
prop.table(table(studentMat$schoolsup))
##famsup
prop.table(table(studentMat$famsup))
##paid
prop.table(table(studentMat$paid))
##activities
prop.table(table(studentMat$activities))
##nursery
prop.table(table(studentMat$nursery))
##higher
prop.table(table(studentMat$higher))
##internet
prop.table(table(studentMat$internet))
##romantic
prop.table(table(studentMat$romantic))
```



Además realizamos los siguientes diagrama de barras e histogramas de las variables binarias que pueden ser más importantes por la influencia de nuestra variable de estudio G3.

```{r, echo=TRUE}
str(studentMat)
#str(studentPor)
barplot(prop.table(table((studentMat$school))))
```

## 4 - Análisis Exploratorio
```{r, echo=FALSE}
##rules <- apriori(studentMat, parameter=list(support=0.5, confidence=0.75))
##inspect(rules)
```

```{r, echo=FALSE}
##d <- dist(as.matrix(studentMat))
##hc <- hclust(d)
##plot(hc)
```

Vamos a hacer correlacion con las variables continuas y categoricas con mas de 4 categorias.

```{r}

#studentNum <-c(studentMat$age, studentMat$absences, studentMat$famrel, studentMat$freetime, studentMat$goout, studentMat$Dalc, studentMat$Walc, studentMat$health, studentMat$G1, studentMat$G2, studentMat$G3)
cor(studentMat[c(3, 30, 24, 25, 26, 27,28, 29, 31, 32, 33)])

```

las variables que hemos analizado , no tienen mucha correlación entre ellas. Siendo las más altas, la relación de Walc con Dalc, y Goout con Walc. Que procederemos a analizar su significatividad.
Las notas finales también están muy corrlacionadas entre sí como se podía esperar.

Nuestra variable objetivo G3, se correlaciona mayormente con edad y goout.Pero su correlación es muy baja.

```{r}
cor.test(studentMat$Walc, studentMat$Dalc)
cor.test(studentMat$Walc, studentMat$goout)
cor.test(studentMat$G3, studentMat$age)
cor.test(studentMat$G3, studentMat$goout)
#cor.test(studentMat$G3, studentMat$health)

```

QUITAR:Procedemos a realizar un scatterolot de nuestra variable objetivo con sus 2 variables más correlacionadas:

```{r}

##plot(studentMat$G3, studentMat$age)
##plot(studentMat$G3, studentMat$goout)

```

Ahora procedemos a analizar las variables binarias y las variables cagtegóricas hasta 4 categorias.

```{r}

barplot(prop.table(table((studentMat$school))))

```

Hacemos una regresión:
lm hacemos una regresión de g3 con todas las variables

despues con un metodo de seleccion de variables, nos quedamos con el mejor modelo, según el criterio AIC.

```{r}
studentReg <- lm(G3 ~ school+ sex+ + age+ address + famsize  + Pstatus + Medu + Fedu + Mjob + Fjob + reason + guardian + traveltime + studytime+ failures + schoolsup + famsup + paid + activities + nursery + higher + internet + romantic + famrel  + freetime  + goout + Dalc + Walc + health + absences , data = studentMat)
summary(studentReg)

step.model <- stepAIC(studentReg, direction = "both", trace = FALSE)
summary(step.model)
```


## 5 - Conclusiones

Las variables jque influyen en la nota final son las variables del ultimo modelo (todas)
